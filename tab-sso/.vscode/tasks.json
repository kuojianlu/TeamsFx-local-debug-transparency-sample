{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Pre Debug Check & Start All",
            "dependsOn": [
                "validate & install prerequisites",
                "install npm packages",
                "prepare local environment",
                "upload teams manifest",
                "start services"
            ],
            "dependsOrder": "sequence"
        },
        {
            "label": "validate & install prerequisites",
            "type": "shell",
            "command": "exit ${input:validate-and-install-prerequisites}",
            "presentation": {
                "reveal": "never"
            }
        },
        {
            "label": "install npm packages",
            "type": "shell",
            "command": "exit ${input:install-npm-packages}",
            "presentation": {
                "reveal": "silent"
            }
        },
        {
            "label": "prepare local environment",
            "type": "shell",
            "command": "exit ${input:prepare-local-environment}",
            "presentation": {
                "reveal": "never"
            }
        },
        {
            "label": "upload teams manifest",
            "type": "shell",
            "command": "exit ${input:upload-teams-manifest}",
            "presentation": {
                "reveal": "never"
            }
        },
        {
            "label": "start services",
            "dependsOn": [
                "start frontend"
            ]
        },
        {
            "label": "start frontend",
            "type": "shell",
            "command": "npm run dev:teamsfx",
            "isBackground": true,
            "options": {
                "cwd": "${workspaceFolder}/tabs"
            },
            "problemMatcher": {
                "pattern": [
                    {
                        "regexp": "^.*$",
                        "file": 0,
                        "location": 1,
                        "message": 2
                    }
                ],
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": ".*",
                    "endsPattern": "Compiled|Failed"
                },
            }
        }
    ],
    "inputs": [
        {
            // This task helps to check the prerequisite to local debug the TeamsFx projects and install the missing dependencies in an easy way. What to check and how to check can be customized in the args section.
            "id": "validate-and-install-prerequisites",
            "type": "command",
            "command": "fx-extension.validate-and-install-prerequisites",
            // The args defined below is auto generated based on the project you scaffolded, to see full list of prerequisite check/installation options, see this page: https://aka.ms/teamsfx-prerequisite.
            "args": {
                "enabledCheckers": [
                    // NodeJs is used to start the project
                    "nodejs",
                    // Login M365 account is used for provision local resource
                    "m365Account",
                    // Local certificate is used to open your local HTTPS tab in your browser
                    "localCertificate",
                    // Validate whether the ports are available
                    "portsOccupation"
                ],
                "portsOccupation": {
                    "tab": 53000
                }
            }
        },
        {
            "id": "install-npm-packages",
            "type": "command",
            "command": "fx-extension.install-npm-packages",
            "args": {
                "tab": {
                    "npmInstallArgs": "--no-audit",
                    "cwd": "${teamsfx:workspaceFolder}/tab",
                    "forceUpdate": false
                }
            }
        },
        {
            "id": "prepare-local-environment",
            "type": "command",
            "command": "fx-extension.debug-task-prepare-local-environment",
            "args": {
                "enabledSteps": [
                    // register an AAD app for Single Sign-On according to the AAD manifest template in templates/appPackage/aad.template.json
                    "registerSSOAAD",
                    // generate Teams app package according to the Teams manifest template in templates/appPackage/manifest.template.json
                    "buildTeamsManifest",
                ],
                "tab": {
                    "port": 53000,
                    // the environment variables for tab service will be appended to this file
                    "envSavePath": "${teamsfx:workspaceFolder}/tabs/.env.teamsfx.local",
                }
            }
        },
        {
            "id": "upload-teams-manifest",
            "type": "command",
            "command": "fx-extension.debug-task-upload-teams-manifest",
            "args": {
                // a Teams app will be registered according to this file
                "manifestZipPackage": "${teamsfx:workspaceFolder}/build/appPackage/appPackage.local.zip"
            }
        }
    ]
}